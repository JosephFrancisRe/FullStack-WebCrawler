<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="utf-8">
    <title>WebCrawler</title>
    
	<!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Ultra&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=ABeeZee&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IM+Fell+DW+Pica+SC&display=swap" rel="stylesheet">
    
	<!-- Bootstrap Library -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" href="css/styles.css">
    
	<!-- Boostrap Javascript -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
	<!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/1c9ad4b785.js" crossorigin="anonymous"></script>
  </head>
  
  <body>
    
	<!-- Nav Bar -->
    
	<section id="nav-section">
      <nav class="navbar bg-dark navbar-dark navbar-expand-lg fixed-top">
        <div id="navigation-bar" class="container-fluid">
          <a class="navbar-brand" href="">WebCrawler</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item">
                <a class="nav-link" href="javascript:alert('Welcome to my Easter Egg!\n\nYou have earned the right to a free month of WebCrawler! And do us a favor, can you forget to unsubscribe for awhile?');">Pricing Plans</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#get-started">Getting Started</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#input">Input</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </section>
    
	<!-- Get Started -->
    
	<section id="get-started">
      <div class="row container-fluid get-started-div">
        <div class="get-started-module col-lg-4 center">
          <i class="get-started-image fas fa-map-marker-alt fa-6x"></i>
          <h3>Set an Origin</h3>
          <p>Input a URL origin to start the automation!</p>
        </div>
        <div class="get-started-module col-lg-4 center">
          <i class="get-started-image fas fa-spider fa-6x"></i>
          <h3>Crawl the Web</h3>
          <p>We create a spider that crawls the web for you!</p>
        </div>
        <div class="get-started-module col-lg-4 center">
          <i class="get-started-image fas fa-images fa-6x"></i>
          <h3>Scrape Some Images</h3>
          <p>View any images she finds along the way!</p>
        </div>
      </div>
    </section>
    
	<!-- Input -->
    
	<section id="input">
      <div class="row container-fluid input-div">
        <div class="input-module col-lg-6 center">
          <h1>Where WebCrawling and ImageScraping meet!</h1>
          <br>
          <h3>Enter a URL to Get Started</h3>
          <form>
            <div>
              <input id="url" type="url" class="form-control" name="url">
            </div>
            <div>
              <button type="button" class="lucky btn btn-dark btn-lg input-button">
                <i class="fas fa-star-shooting"></i> I'm Feeling Lucky </button>
              <button type="submit" class="btn btn-dark btn-lg input-button submit">
                <i class="fas fa-file-check"></i> Submit </button>
              <button type="button" class="reset btn btn-dark input-button btn-lg">
                <i class="fas fa-trash-can-undo"></i> Reset </button>
            </div>
          </form>
        </div>
      </div>
    </section>
    
	<!-- Output -->
    
	<section id="output">
      <div class="output-div">
        <div class="row container-fluid output-module">
          <h1 id="images" text-align="center" style="display: none">IMAGES</h1>
          <ul class="images"></ul>
        </div>
        <div class="row container-fluid output-module">
          <h1 id="logos" text-align="center" style="display: none">LOGOS</h1>
          <ul class="logos"></ul>
        </div>
      </div>
    </section>
    
	<!-- Footer -->
    
	<footer id="footer">
      <p class="center">Joseph Re's Eulerity Hackathon Challenge Submission</p>
    </footer>
    
	<!-- JavaScript -->
	
	<script>
      var imageList = document.querySelector('ul.images');
      var logoList = document.querySelector('ul.logos');
      var urlInput = document.querySelector('input[name=url]');
      var imagesDoc = document.getElementById("images");
      var logosDoc = document.getElementById("logos");
      apiCallBack = function(xhr, callback) {
        if (xhr.readyState == XMLHttpRequest.DONE) {
          if (xhr.status != 200) {
            let message = xhr.status + ":" + xhr.statusText + ":" + xhr.responseText;
            alert(message);
            throw 'API call returned bad code: ' + xhr.status;
          }
          console.log(xhr.responseText);
          let response = xhr.responseText ? JSON.parse(xhr.responseText) : null;
          if (callback) {
            callback(response);
          }
        }
      }
      updateList = function(response) {
        imageList.innerHTML = '';
        imagesDoc.style.display = "block";
        logosDoc.style.display = "block";
        for (var i = 0; i < response.length; i++) {
          if (response[i]) {
            var img = document.createElement("img");
            img.width = 200;
            img.src = response[i];
            if (!response[i].includes(".svg") || !response[i].includes("favicon")) {
              imageList.appendChild(img);
            } else {
              logoList.appendChild(img);
            }
          }
        }
      }
      makeApiCall = function(url, method, obj, callback) {
        let xhr = new XMLHttpRequest();
        xhr.open(method, url);
        xhr.onreadystatechange = apiCallBack.bind(null, xhr, callback);
        xhr.send(obj ? obj instanceof FormData || obj.constructor == String ? obj : JSON.stringify(obj) : null);
      }
      document.querySelector('.lucky').addEventListener("click", function(event) {
        event.preventDefault();
        var verifiedSites = ['http://books.toscrape.com/', 'https://ashesofcreation.com/'];
        var randomIndex = Math.floor(Math.random() * verifiedSites.length);
        document.getElementById('url').setAttribute('value', verifiedSites[randomIndex]);
        makeApiCall('/main?url=' + verifiedSites[randomIndex], 'POST', null, updateList);
      });
      document.querySelector('.submit').addEventListener("click", function(event) {
        event.preventDefault();
        makeApiCall('/main?url=' + urlInput.value, 'POST', null, updateList);
      });
      document.querySelector('.reset').addEventListener("click", function(event) {
        event.preventDefault();
        imagesDoc.style.display = "none";
        logosDoc.style.display = "none";
        document.querySelector('ul.images').innerHTML = '';
        document.querySelector('ul.logos').innerHTML = '';
        makeApiCall('/main?url=', 'DELETE', null, null);
      });
    </script>
	
  </body>
</html>